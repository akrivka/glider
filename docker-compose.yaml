services:
  # Scheduler worker service (same image, different entrypoint)
  glider-worker:
    build:
      context: .
      dockerfile: glider-operator/Dockerfile
    environment:
      - SURREALDB_URL=ws://surrealdb:8000
      - SURREALDB_USER=root
      - SURREALDB_PASS=root
      - GLIDER_CONFIG_TOML=/app/config.toml
    volumes:
      - ./glider-operator/secrets:/app/secrets
      - ./glider-operator/config.toml:/app/config.toml:ro
    command: ["python", "-m", "glider.scheduler"]

  # SvelteKit Frontend (direct DB access)
  glider-web:
    build:
      context: ./glider-web
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - SURREALDB_URL=ws://surrealdb:8000
      - SURREALDB_USER=root
      - SURREALDB_PASS=root
      - SURREALDB_NS=glider
      - SURREALDB_DB=glider
    depends_on:
      surrealdb:
        condition: service_started

  # SurrealDB (using memory storage for development)
  surrealdb:
    image: surrealdb/surrealdb:latest
    ports:
      - "8001:8000"
    command: start --user root --pass root memory

  # Surrealist UI (SurrealDB's official UI)
  surrealist:
    image: surrealdb/surrealist:latest
    ports:
      - "8002:8080"
    depends_on:
      - surrealdb
